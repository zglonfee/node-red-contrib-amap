<script type="text/javascript">
    RED.nodes.registerType('amap-distance',{
        category: 'amap',
        color: '#25A5F7',
        defaults: {
            name : {value:""},
            amap_key: {value:"", type:"amap-key"},

            // src info
            src_type: {value:""},
            src_cfg: {value:"", type:"amap-location"},
            src_dyn_longitude: {value:""},
            src_dyn_latitude:{value:""},

            // dest info
            dest_type: {value:""},
            dest_cfg: {value:"", type:"amap-location"},
            dest_dyn_longitude: {value:""},
            dest_dyn_latitude:{value:""},
        },
        inputs:1,
        outputs:1,
        icon: "font-awesome/fa-arrows-h",
        label: function() {
            return this.name|| this._("amap.distance.name");
        },
        oneditprepare:function (){
            $("#node-input-dest_type").typedInput({
                types: [
                    {
                        value: "dest_type",
                        options: [
                            { value: "static", label: this._("amap.distance.location_type_static")},
                            { value: "dynamic", label: this._("amap.distance.location_type_dynamic")},
                        ]
                    }
                ]
            })

            $("#node-input-dest_type").on('change',function() {
                if (this.value === 'dynamic') {
                    $("#node-dynamic-dest").show();
                    $("#node-static-dest").hide()
                }
                else {
                    $("#node-dynamic-dest").hide();
                    $("#node-static-dest").show()
                }
            });

            $("#node-input-src_type").typedInput({
                types: [
                    {
                        value: "src type",
                        options: [
                            { value: "static", label: this._("amap.distance.location_type_static")},
                            { value: "dynamic", label: this._("amap.distance.location_type_dynamic")},
                        ]
                    }
                ]
            })

            $("#node-input-src_type").on('change',function() {
                if (this.value === 'dynamic') {
                    $("#node-dynamic-src").show();
                    $("#node-static-src").hide()
                }
                else {
                    $("#node-dynamic-src").hide();
                    $("#node-static-src").show()
                }
            });

            let locationRoot = $("#node-location")
            CreateLocationStruct(this, locationRoot)
        }
    });

    function InitLocationInput(){
        $("#node-input-src_type").typedInput({
            types: [
                {
                    value: "src type",
                    options: [
                        { value: "static", label: this._("amap.distance.location_type_static")},
                        { value: "dynamic", label: this._("amap.distance.location_type_dynamic")},
                    ]
                }
            ]
        })
    }

    function CreateLocationStruct(node, locationRoot){
        var strName = node._("amap.common.name");
        var strType = node._("amap.distance.src_type");
        var strLocation = node._("amap.distance.location")
        var strLongitude = node._("amap.distance.longitude");
        var strLatitude = node._("amap.distance.latitude");

        let fragment = document.createDocumentFragment();
        var rowType = $('<div/>',{class:"form-row"}).appendTo(fragment);
        var rowStatic = $('<div/>',{class:"form-row",id:"node-static-src"}).appendTo(fragment);
        var rowDynamic = $('<div/>',{class:"form-row",id:"node-dynamic-src"}).appendTo(fragment);

        // type
        var rowType_Label = $('<label><label/>').appendTo(rowType);
        $('<i></i>', {class:"fa fa-map-marker"}).appendTo(rowType_Label);
        $('<span>').text(" ").appendTo(rowType_Label);
        $('<span>').text(strType).appendTo(rowType_Label);
        var eleType = $('<input type="text" class="node-input-type" style="width: 70%">').appendTo(rowType);

        // static
        $('<label for="node-input-src_cfg"><label/>').appendTo(rowStatic);
        var rowStatic_Label = $('<label><label/>', {style:"width: 20%"}).appendTo(rowStatic);
        $('<span>').text(strLocation).appendTo(rowStatic_Label);
        var locationCfg = $('<input type="text" id="node-input-src_cfg" style="width: 50%">').appendTo(rowStatic);
        //console.log(locationCfg.typedInput("type"));
        //locationCfg.typedInput({type: "amap-location"})

        // dynamic
        var rowDyn_Longitude = $('<div/>',{class:"form-row"}).appendTo(rowDynamic);
        $('<label><label/>').appendTo(rowDyn_Longitude);
        var rowDyn_LongitudeLabel = $('<label><label/>', {style:"width: 20%"}).appendTo(rowDyn_Longitude);
        $('<span>').text(strLongitude).appendTo(rowDyn_LongitudeLabel);
        var dynLongitude = $('<input type="text" class="node-input-type" style="width: 50%">').appendTo(rowDyn_Longitude);

        var rowDyn_Latitude = $('<div/>',{class:"form-row"}).appendTo(rowDynamic);
        $('<label><label/>').appendTo(rowDyn_Latitude);
        var rowDyn_LatitudeLabel = $('<label><label/>', {style:"width: 20%"}).appendTo(rowDyn_Latitude);
        $('<span>').text(strLatitude).appendTo(rowDyn_LatitudeLabel);
        var dynLatitude = $('<input type="text" class="node-input-type" style="width: 50%">').appendTo(rowDyn_Latitude);

        eleType.typedInput({
                types: [
                    {
                        value: "static",
                        options: [
                            { value: "static", label: node._("amap.distance.location_type_static")},
                            { value: "dynamic", label: node._("amap.distance.location_type_dynamic")},
                        ]
                    }
                ]
            })
            
        eleType.on('change',function() {
                if (this.value === 'dynamic') {
                    rowDynamic.show();
                    rowStatic.hide()
                }
                else {
                    rowDynamic.hide();
                    rowStatic.show()
                }
            });
        locationRoot.append(fragment)
    }

</script>

<script type="text/html" data-template-name="amap-distance">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="amap.common.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]amap.common.name" style="width: 70%">
    </div>

    <div class="form-row">
        <label for="node-input-amap_key"><i class="fa fa-key"></i> <span data-i18n="amap.distance.key"></span></label>
        <input type="text" id="node-input-amap_key" style="width: 70%">
    </div>

    <div class="form-row" id="node-location">

    </div>
</script>
